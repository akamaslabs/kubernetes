name: Optimizing the Online Boutique by Google
system: Online Boutique
workflow: boutique

goal:
  objective: maximize
  function:
    formula: online_boutique.transactions_throughput
  constraints:
    absolute:
      - online_boutique.transactions_error_rate <= 0.02

windowing:
  type: trim
  trim: [1m, 1m]
  task: Test

metricsSelection:
  - online_boutique.users
  - online_boutique.transactions_throughput
  - online_boutique.transactions_error_throughput
  - online_boutique.transactions_error_rate
  - online_boutique.transactions_response_time
  - online_boutique.transactions_response_time_p50
  - online_boutique.transactions_response_time_p95
  - frontend.container_cpu_used
  - frontend.container_cpu_util
  - frontend.container_cpu_limit
  - frontend.container_cpu_throttle_time
  - frontend.container_mem_used
  - frontend.container_mem_util
  - frontend.container_mem_limit
  - checkoutservice.container_cpu_used
  - checkoutservice.container_cpu_util
  - checkoutservice.container_cpu_limit
  - checkoutservice.container_cpu_throttle_time
  - checkoutservice.container_mem_used
  - checkoutservice.container_mem_util
  - checkoutservice.container_mem_limit
  - adservice.container_cpu_used
  - adservice.container_cpu_util
  - adservice.container_cpu_limit
  - adservice.container_cpu_throttle_time
  - adservice.container_mem_used
  - adservice.container_mem_util
  - adservice.container_mem_limit
  - currencyservice.container_cpu_used
  - currencyservice.container_cpu_util
  - currencyservice.container_cpu_limit
  - currencyservice.container_cpu_throttle_time
  - currencyservice.container_mem_used
  - currencyservice.container_mem_util
  - currencyservice.container_mem_limit
  - shippingservice.container_cpu_used
  - shippingservice.container_cpu_util
  - shippingservice.container_cpu_limit
  - shippingservice.container_cpu_throttle_time
  - shippingservice.container_mem_used
  - shippingservice.container_mem_util
  - shippingservice.container_mem_limit
  - productcatalogservice.container_cpu_used
  - productcatalogservice.container_cpu_util
  - productcatalogservice.container_cpu_limit
  - productcatalogservice.container_cpu_throttle_time
  - productcatalogservice.container_mem_used
  - productcatalogservice.container_mem_util
  - productcatalogservice.container_mem_limit
  - recommendationservice.container_cpu_used
  - recommendationservice.container_cpu_util
  - recommendationservice.container_cpu_limit
  - recommendationservice.container_cpu_throttle_time
  - recommendationservice.container_mem_used
  - recommendationservice.container_mem_util
  - recommendationservice.container_mem_limit
  - emailservice.container_cpu_used
  - emailservice.container_cpu_util
  - emailservice.container_cpu_limit
  - emailservice.container_cpu_throttle_time
  - emailservice.container_mem_used
  - emailservice.container_mem_util
  - emailservice.container_mem_limit
  - cartservice.container_cpu_used
  - cartservice.container_cpu_util
  - cartservice.container_cpu_limit
  - cartservice.container_cpu_throttle_time
  - cartservice.container_mem_used
  - cartservice.container_mem_util
  - cartservice.container_mem_limit
  - paymentservice.container_cpu_used
  - paymentservice.container_cpu_util
  - paymentservice.container_cpu_limit
  - paymentservice.container_cpu_throttle_time
  - paymentservice.container_mem_used
  - paymentservice.container_mem_util
  - paymentservice.container_mem_limit
  - rediscart.container_cpu_used
  - rediscart.container_cpu_util
  - rediscart.container_cpu_limit
  - rediscart.container_cpu_throttle_time
  - rediscart.container_mem_used
  - rediscart.container_mem_util
  - rediscart.container_mem_limit

parametersSelection:
  - name: frontend.limits_cpu
    domain: [0.2, 2.5]
  - name: frontend.limits_memory
    domain: [64, 1024]
  - name: adservice.limits_cpu
    domain: [0.1, 0.5]
  - name: adservice.limits_memory
    domain: [64, 1024]
  - name: cartservice.limits_cpu
    domain: [0.1, 1.5]
  - name: cartservice.limits_memory
    domain: [64, 1024]
  - name: checkoutservice.limits_cpu
    domain: [0.1, 1.5]
  - name: checkoutservice.limits_memory
    domain: [64, 1024]
  - name: currencyservice.limits_cpu
    domain: [0.1, 1.5]
  - name: currencyservice.limits_memory
    domain: [64, 1024]
  - name: emailservice.limits_cpu
    domain: [0.1, 0.5]
  - name: emailservice.limits_memory
    domain: [64, 1024]
  - name: paymentservice.limits_cpu
    domain: [0.1, 0.5]
  - name: paymentservice.limits_memory
    domain: [64, 1024]
  - name: productcatalogservice.limits_cpu
    domain: [0.1, 1.5]
  - name: productcatalogservice.limits_memory
    domain: [64, 1024]
  - name: recommendationservice.limits_cpu
    domain: [0.1, 3.0]
  - name: recommendationservice.limits_memory
    domain: [64, 1024]
  - name: shippingservice.limits_cpu
    domain: [0.1, 0.5]
  - name: shippingservice.limits_memory
    domain: [64, 1024]
  - name: rediscart.limits_cpu
    domain: [0.1, 0.5]
  - name: rediscart.limits_memory
    domain: [64, 1024]

steps:
  - name: baseline
    type: baseline
    values:
      frontend.requests_cpu: 0.1
      frontend.requests_memory: 64
      frontend.limits_cpu: 0.2
      frontend.limits_memory: 128

      cartservice.requests_cpu: 0.2
      cartservice.requests_memory: 64
      cartservice.limits_cpu: 0.3
      cartservice.limits_memory: 128

      adservice.requests_cpu: 0.2
      adservice.requests_memory: 180
      adservice.limits_cpu: 0.3
      adservice.limits_memory: 300

      emailservice.requests_cpu: 0.1
      emailservice.requests_memory: 64
      emailservice.limits_cpu: 0.2
      emailservice.limits_memory: 128

      checkoutservice.requests_cpu: 0.1
      checkoutservice.requests_memory: 64
      checkoutservice.limits_cpu: 0.2
      checkoutservice.limits_memory: 128

      recommendationservice.requests_cpu: 0.1
      recommendationservice.requests_memory: 220
      recommendationservice.limits_cpu: 0.2
      recommendationservice.limits_memory: 450

      paymentservice.requests_cpu: 0.1
      paymentservice.requests_memory: 64
      paymentservice.limits_cpu: 0.2
      paymentservice.limits_memory: 128

      productcatalogservice.requests_cpu: 0.1
      productcatalogservice.requests_memory: 64
      productcatalogservice.limits_cpu: 0.2
      productcatalogservice.limits_memory: 128

      currencyservice.requests_cpu: 0.1
      currencyservice.requests_memory: 64
      currencyservice.limits_cpu: 0.2
      currencyservice.limits_memory: 128

      shippingservice.requests_cpu: 0.1
      shippingservice.requests_memory: 64
      shippingservice.limits_cpu: 0.2
      shippingservice.limits_memory: 128

      rediscart.requests_cpu: 0.1
      rediscart.requests_memory: 200
      rediscart.limits_cpu: 0.125
      rediscart.limits_memory: 256

  - name: optimize
    type: optimize
    optimizer: AKAMAS
    numberOfExperiments: 200
    numberOfTrials: 1
    maxFailedExperiments: 100
